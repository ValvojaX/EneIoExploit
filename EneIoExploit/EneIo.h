#pragma once
#include <Windows.h>
#include <winternl.h>
#include <cstdio>

#define IOCTL_WINIO_MAPPHYSTOLIN	0x80102040
#define IOCTL_WINIO_UNMAPPHYSADDR	0x80102044
#define IOCTL_WINIO_READPORT		0x80102050
#define IOCTL_WINIO_WRITEPORT		0x80102054
#define IOCTL_WINIO_READMSR			0x80102058
#define IOCTL_WINIO_WRITEMSR		0x8010205C

struct SECTION_MAP_INFO {
	_In_ SIZE_T CommitSize;
	_In_ PLARGE_INTEGER SectionOffset;
	_Out_ HANDLE SectionHandle;
	_Out_ PVOID BaseAddress;
	_Out_ PVOID Object;
};

class EneIo
{
public:
	EneIo();
	~EneIo();

public:
	BOOL MapViewOfSection(SECTION_MAP_INFO &buffer);
	BOOL UnmapViewOfSection(SECTION_MAP_INFO &buffer);
	void ReadPort();
	void WritePort();
	void ReadMsr();
	void WriteMsr();

private:
	HANDLE hDevice;
};